<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TCG Expert Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#0b0f14;
  --card:#121826;
  --accent:#ff3b3b;
  --accent2:#00e5ff;
  --accent3:#8cff00;
  --text:#eaeaea;

  --shadow: 0 14px 34px rgba(0,0,0,.52);
  --shadow2: 0 10px 22px rgba(0,0,0,.30);
}
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
html{scroll-behavior:smooth;}
body{
  margin:0;
  color:var(--text);
  background:
    radial-gradient(900px 520px at 15% 0%, rgba(0,229,255,.10), transparent 55%),
    radial-gradient(900px 520px at 90% 10%, rgba(255,59,59,.10), transparent 55%),
    radial-gradient(900px 700px at 50% 110%, rgba(140,255,0,.07), transparent 60%),
    var(--bg);
}

/* Modal */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:3000;}
.modal-content{
  background:#121826;
  padding:20px;
  margin:10% auto;
  width:90%;
  max-width:560px;
  border-radius:16px;
  box-shadow: 0 26px 70px rgba(0,0,0,.6);
  border:1px solid rgba(255,255,255,.08);
}

/* Header */
header{
  position:sticky;top:0;z-index:1000;
  background:rgba(14,19,32,.86);
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,.06);
  backdrop-filter: blur(10px);
}
.left-header{display:flex;align-items:center;gap:12px;}
.menu-btn{
  font-size:26px;cursor:pointer;user-select:none;
  padding:6px 8px;border-radius:12px;
  transition:transform .15s ease, filter .15s ease, background .15s ease;
}
.menu-btn:hover{
  transform:translateY(-1px);
  filter:drop-shadow(0 0 12px rgba(0,229,255,.30));
  background:rgba(255,255,255,.03);
}

/* LOGO bigger */
.header-logo{
  height:74px;
  width:auto;
  display:block;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  box-shadow: 0 18px 40px rgba(0,0,0,.55);
  filter: drop-shadow(0 0 18px rgba(0,229,255,.18));
}

/* PRO badge */
.badge{
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: linear-gradient(90deg, rgba(0,229,255,.10), rgba(255,59,59,.08));
  box-shadow: 0 10px 20px rgba(0,0,0,.25);
  font-size:12px;
  letter-spacing:.6px;
  font-weight:900;
  text-transform:uppercase;
  user-select:none;
}

/* SW indicator */
.sw-indicator{
  display:flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:14px;
  background: rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  box-shadow: var(--shadow2);
  font-size:12px;white-space:nowrap;user-select:none;
}
.sw-dot{width:10px;height:10px;border-radius:50%;background:#666;}
.sw-text{opacity:.9}

/* Drawer */
.drawer{
  position:fixed;top:0;left:-260px;width:260px;height:100%;
  background:#0f1629;padding:20px;transition:0.3s;z-index:2000;
  border-right:1px solid rgba(255,255,255,.08);
  box-shadow: 18px 0 40px rgba(0,0,0,.55);
  overflow-y:auto;
}
.drawer a{
  display:block;color:#fff;text-decoration:none;padding:12px 0;
  border-bottom:1px solid #1c2340;
  transition: padding-left .15s ease, color .15s ease, background .15s ease;
}
.drawer a:hover{padding-left:10px;color:var(--accent2);background: rgba(0,229,255,.06);}
.drawer.open{left:0}

/* Sections + left premium rail */
section{
  padding:26px 18px;
  position:relative;
}
section::before{
  content:"";
  position:absolute;
  left:8px;
  top:18px;
  bottom:18px;
  width:3px;
  border-radius:6px;
  background: linear-gradient(180deg, rgba(0,229,255,.58), rgba(255,59,59,.40), rgba(140,255,0,.28));
  box-shadow: 0 0 18px rgba(0,229,255,.14);
  opacity:.95;
}
section::after{
  content:"";
  position:absolute;
  left:6px; top:14px;
  width:7px;height:7px;border-radius:8px;
  background: rgba(0,229,255,.65);
  box-shadow: 0 0 18px rgba(0,229,255,.18);
  opacity:.9;
}
section > *{ position:relative; z-index:1; }

h2{
  margin-top:0;margin-bottom:10px;
  font-size:34px;
  letter-spacing:.2px;
  text-shadow: 0 8px 28px rgba(0,0,0,.45);
}
h2::after{
  content:"";
  display:block;
  height:2px;
  width:120px;
  margin-top:10px;
  background: linear-gradient(90deg, rgba(0,229,255,.85), rgba(255,59,59,.65), rgba(140,255,0,.55));
  border-radius:10px;
  box-shadow: 0 0 18px rgba(0,229,255,.18);
  opacity:.85;
}
.sub{opacity:.8;margin-bottom:15px;font-size:14px;line-height:1.4}
.small{font-size:13px;opacity:.85;line-height:1.45}

/* Cards */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) , var(--card);
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow: var(--shadow);
  border:1px solid rgba(255,255,255,.08);
  position:relative;
  overflow:hidden;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.card:hover{
  transform: translateY(-2px);
  border-color: rgba(0,229,255,.18);
  box-shadow: 0 18px 46px rgba(0,0,0,.58);
}
.card::before{
  content:"";
  position:absolute; inset:-2px;
  background:
    radial-gradient(520px 220px at 0% 0%, rgba(0,229,255,.12), transparent 60%),
    radial-gradient(520px 220px at 100% 100%, rgba(255,59,59,.10), transparent 60%);
  opacity:.85;
  pointer-events:none;
}
.card > *{position:relative; z-index:1;}

/* PREMIUM BUTTONS (revamp) */
@keyframes tapPulse { 0%{transform:scale(1)} 60%{transform:scale(.985)} 100%{transform:scale(1)} }
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  width:auto;

  padding:12px 16px;
  border-radius:14px;
  background: linear-gradient(135deg, rgba(255,59,59,.95), rgba(255,159,26,.75));
  color:#fff;
  text-decoration:none;
  font-weight:900;
  letter-spacing:.2px;
  border:1px solid rgba(255,255,255,.12);
  cursor:pointer;
  transition: transform .15s ease, filter .15s ease, box-shadow .15s ease, border-color .15s ease;
  box-shadow: 0 14px 28px rgba(0,0,0,.38);
  position:relative;
  overflow:hidden;
}
.btn:hover{
  transform: translateY(-2px);
  border-color: rgba(255,255,255,.22);
  box-shadow: 0 18px 34px rgba(0,0,0,.45), 0 0 22px rgba(255,59,59,.30);
  filter: brightness(1.06);
}
.btn:active{ animation: tapPulse .18s ease; }
.btn.alt{
  background: linear-gradient(135deg, rgba(0,229,255,.95), rgba(110,170,255,.70));
  color:#031019;
}
.btn.alt:hover{ box-shadow:0 18px 34px rgba(0,0,0,.45), 0 0 22px rgba(0,229,255,.25); }
.btn.green{
  background: linear-gradient(135deg, rgba(140,255,0,.95), rgba(0,229,255,.40));
  color:#07120d;
}
.btn.green:hover{ box-shadow:0 18px 34px rgba(0,0,0,.45), 0 0 22px rgba(140,255,0,.20); }
.btn.gray{
  background: linear-gradient(135deg, rgba(42,47,69,.92), rgba(18,24,38,.92));
  color:#fff;
}
.btn.gray:hover{ box-shadow:0 18px 34px rgba(0,0,0,.45), 0 0 16px rgba(255,255,255,.10); }

/* subtle shine sweep */
.btn::after{
  content:"";
  position:absolute; top:-45%; left:-70%;
  width:45%; height:200%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.25), transparent);
  transform: rotate(22deg);
  opacity:0;
  transition: opacity .15s ease, left .55s ease;
}
.btn:hover::after{ opacity:.95; left:130%; }

input,textarea,select{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  margin-bottom:10px;
  background:#0b1222;
  color:#eaeaea;
  box-shadow: 0 10px 18px rgba(0,0,0,.25);
  outline:none;
}
input:focus,select:focus,textarea:focus{
  border-color: rgba(0,229,255,.45);
  box-shadow: 0 10px 18px rgba(0,0,0,.25), 0 0 20px rgba(0,229,255,.18);
}
select option{background:#0b1222;color:#eaeaea;}

/* checkbox fix */
input[type="checkbox"]{
  width:auto !important;
  min-width:22px;
  height:22px;
  margin:0;
  padding:0;
  box-shadow:none;
}

/* checklist rows */
.check-item{
  display:flex;
  align-items:center;
  gap:12px;
  width:100%;
  margin:10px 0;
  padding:14px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
  background:rgba(255,255,255,.02);
}
.check-item:hover{
  border-color: rgba(0,229,255,.18);
  box-shadow: 0 0 18px rgba(0,229,255,.08);
}
.check-item label{
  flex:1;
  margin:0;
  text-align:left;
  line-height:1.35;
  cursor:pointer;
}

/* grids */
.poke-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:14px;
}

/* PREMIUM BOXES (replaces orange border rubbish) */
.poke-box{
  position:relative;
  border-radius:18px;
  padding:16px 14px;
  text-align:center;
  cursor:pointer;
  user-select:none;

  background:
    radial-gradient(520px 140px at 50% -10%, rgba(0,229,255,.10), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.10);
  box-shadow: 0 14px 30px rgba(0,0,0,.30);
  transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease, filter .15s ease;
  overflow:hidden;
}
.poke-box::before{
  content:"";
  position:absolute; inset:-2px;
  background: linear-gradient(135deg, rgba(0,229,255,.20), rgba(255,59,59,.14), rgba(140,255,0,.12));
  opacity:.55;
  pointer-events:none;
}
.poke-box::after{
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(420px 120px at 50% 0%, rgba(255,255,255,.10), transparent 60%);
  opacity:.60;
  pointer-events:none;
}
.poke-box:hover{
  transform: translateY(-2px);
  border-color: rgba(0,229,255,.22);
  box-shadow: 0 18px 40px rgba(0,0,0,.40), 0 0 24px rgba(0,229,255,.10);
  filter: brightness(1.03);
}
.poke-box:active{ animation: tapPulse .18s ease; }
.poke-box > *{position:relative; z-index:1;}

/* Toolkit small */
.hero-card{ max-width:520px; margin:0 auto; }
.toolkit-img{
  width:100%;
  max-width: 320px;
  height: 110px;
  object-fit: cover;
  object-position: center;
  display:block;
  margin: 0 auto;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  box-shadow: 0 14px 34px rgba(0,0,0,.55);
}

/* Reveal: hidden by default (failsafe in JS) */
.reveal{opacity:0;transform: translateY(10px);transition: opacity .42s ease, transform .42s ease;}
.reveal.show{opacity:1;transform: translateY(0px);}

@media (max-width:520px){
  h2{font-size:32px;}
  .header-logo{height:74px;}
  .toolkit-img{max-width: 300px; height: 105px;}
}

/* Cookies */
.cookie-popup{
  position:fixed;left:14px; right:14px; bottom:14px;
  z-index:4000;display:none;
  background:#121826;border:1px solid #1c2340;border-radius:16px;
  padding:14px;box-shadow: 0 18px 50px rgba(0,0,0,.60);
}
.cookie-popup.show{display:block;}
.cookie-row{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;}
.cookie-text{font-size:13px;opacity:.9;line-height:1.4;flex:1;min-width:220px;}
.cookie-actions{display:flex;gap:10px;flex-wrap:wrap;}
.cookie-actions .btn{margin:0;}
hr.soft{border:0;border-top:1px solid rgba(255,255,255,.10);margin:14px 0;}

/* Floating Back to Top */
#toTop{
  position:fixed;
  right:14px;
  bottom:86px;
  z-index:3500;
  display:none;
  padding:12px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(18,24,38,.92);
  box-shadow: 0 18px 50px rgba(0,0,0,.60);
  color:#fff;
  cursor:pointer;
  backdrop-filter: blur(10px);
}
#toTop:hover{ border-color: rgba(0,229,255,.22); box-shadow:0 18px 50px rgba(0,0,0,.60), 0 0 18px rgba(0,229,255,.12); }

/* Premium: Deal Score bar */
.score-wrap{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.02);
}
.score-top{
  display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
}
.score-title{font-weight:900;letter-spacing:.2px;}
.score-grade{
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  font-size:12px;
}
.score-bar{
  height:12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.25);
  overflow:hidden;
  margin-top:10px;
}
.score-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(255,59,59,.85), rgba(0,229,255,.85), rgba(140,255,0,.85));
  box-shadow: 0 0 18px rgba(0,229,255,.18);
  transition: width .35s ease;
}
.score-hint{margin-top:10px;font-size:12px;opacity:.78;line-height:1.35}

/* Premium: Watchlist rows */
.watch-row{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
  padding:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.02);
  margin:10px 0;
}
.watch-left{display:flex;flex-direction:column;gap:6px;min-width:220px;flex:1;}
.watch-title{font-weight:900;}
.watch-note{font-size:12px;opacity:.78}
.watch-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
.pill-mini{
  padding:7px 12px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  font-size:12px;
  opacity:.9;
}

/* Button layout fix (Mobile first) */
.btn-grid{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:10px;
  margin-top:10px;
}
.btn-grid .btn{width:100%; margin:0;}
@media (min-width:640px){
  .btn-grid{grid-template-columns:repeat(3, minmax(0, 1fr));}
}
@media (min-width:980px){
  .btn-grid{grid-template-columns:repeat(4, minmax(0, 1fr));}
}

/* Quick chips */
.chips{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:8px;
}
.chip{
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  font-size:12px;
  cursor:pointer;
  user-select:none;
  transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
}
.chip:hover{
  transform: translateY(-1px);
  border-color: rgba(0,229,255,.20);
  box-shadow: 0 0 14px rgba(0,229,255,.10);
}

/* Step panel */
.step-panel{
  padding:14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.02);
}
.steps{
  margin:10px 0 0;
  padding-left:18px;
  line-height:1.5;
  font-size:13px;
  opacity:.9;
}

/* Onboarding overlay */
.onboard{
  position:fixed;
  inset:0;
  z-index:5000;
  display:none;
  background: rgba(0,0,0,.72);
  backdrop-filter: blur(6px);
}
.onboard.show{display:block;}
.onboard-card{
  width:min(560px, 92vw);
  margin:12vh auto 0;
  background: rgba(18,24,38,.96);
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;
  box-shadow: 0 26px 70px rgba(0,0,0,.65);
  overflow:hidden;
}
.onboard-top{ padding:16px 16px 0; }
.onboard-title{ font-size:18px; font-weight:900; letter-spacing:.2px; }
.onboard-sub{font-size:13px;opacity:.82;margin-top:6px;line-height:1.4}
.onboard-steps{ padding:14px 16px 16px; }
.onboard-step{
  display:flex;gap:12px;align-items:flex-start;
  padding:12px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
  background: rgba(255,255,255,.02);
  margin-top:10px;
}
.onboard-num{
  width:28px;height:28px;border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  font-weight:900;
  background: rgba(0,229,255,.12);
  border:1px solid rgba(0,229,255,.25);
  box-shadow: 0 0 18px rgba(0,229,255,.10);
}
.onboard-actions{
  display:flex;gap:10px;flex-wrap:wrap;
  padding:14px 16px 18px;
  border-top:1px solid rgba(255,255,255,.08);
  justify-content:flex-end;
}
.onboard-actions .btn{margin:0;}

/* Checkout panel */
.kv{
  display:flex;gap:10px;flex-wrap:wrap;align-items:center;
  padding:12px;border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.02);
}
.kv .k{opacity:.8;font-size:12px;min-width:120px;}
.kv .v{font-weight:900;word-break:break-all;}
.mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.alert{
  padding:12px;border-radius:16px;
  border:1px solid rgba(255,59,59,.25);
  background: rgba(255,59,59,.06);
  font-size:12px; line-height:1.45;
}
.ok{
  padding:12px;border-radius:16px;
  border:1px solid rgba(140,255,0,.25);
  background: rgba(140,255,0,.06);
  font-size:12px; line-height:1.45;
}
.badge-mini{
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  font-size:12px;font-weight:900;
}
</style>
</head>

<body>

<!-- Disclaimer -->
<div class="modal" id="disclaimerModal" style="display:block;">
  <div class="modal-content">
    <h3>Disclaimer</h3>
    <p>This toolkit is for educational and reference purposes only. Always verify cards with official grading services before purchase. TCG Expert Pro is not responsible for any financial loss, counterfeit, or fake cards.</p>
    <a class="btn" onclick="document.getElementById('disclaimerModal').style.display='none'">Accept</a>
  </div>
</div>

<!-- Onboarding -->
<div id="onboard" class="onboard" aria-hidden="true">
  <div class="onboard-card">
    <div class="onboard-top">
      <div class="onboard-title">Welcome to TCG Expert Pro</div>
      <div class="onboard-sub">Here’s the fastest way to price + verify in under 30 seconds.</div>
    </div>

    <div class="onboard-steps">
      <div class="onboard-step">
        <div class="onboard-num">1</div>
        <div><b>Verify PSA</b><br>Enter a cert number → open the official PSA page.</div>
      </div>
      <div class="onboard-step">
        <div class="onboard-num">2</div>
        <div><b>Generate Comps</b><br>Type your card name → tap <b>Generate Comps</b> → open Sold + databases.</div>
      </div>
      <div class="onboard-step">
        <div class="onboard-num">3</div>
        <div><b>Grade the Listing</b><br>Use Listing Quality Grader + Deal Score to avoid bad buys and spot gems.</div>
      </div>
    </div>

    <div class="onboard-actions">
      <button class="btn gray" onclick="skipOnboarding()">Skip</button>
      <button class="btn green" onclick="finishOnboarding()">Start Using Pro</button>
    </div>
  </div>
</div>

<!-- Checkout Modal -->
<div class="modal" id="checkoutModal" aria-hidden="true">
  <div class="modal-content">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
      <h3 style="margin:0;">USDT Payment</h3>
      <button class="btn gray" onclick="closeCheckout()" style="margin:0;">Close</button>
    </div>

    <p class="small" style="margin-top:10px;">
      Pay using <b>USDT (Tether)</b> on the <b>Ethereum network (ERC-20)</b> only.
    </p>

    <div class="alert">
      <b>Crypto disclaimer:</b> Crypto payments are final. Send <b>USDT on Ethereum (ERC-20)</b> only.
      Sending funds on the wrong network may result in permanent loss. We are not responsible for lost funds due to user error.
    </div>

    <div class="kv" style="margin-top:12px;">
      <div class="k">Network</div>
      <div class="v"><span class="badge-mini">USDT • Ethereum (ERC-20)</span></div>
    </div>

    <div class="kv" style="margin-top:10px;">
      <div class="k">Wallet</div>
      <div class="v mono" id="usdtWallet">0x15F4628c103D56eF81EDC45c7C3af33dA0B8442E</div>
      <button class="btn alt" onclick="copyWallet()" style="margin-left:auto;">Copy</button>
    </div>

    <div class="kv" style="margin-top:10px;">
      <div class="k">Payment type</div>
      <div class="v" id="payTypeLabel">—</div>
    </div>

    <div class="kv" style="margin-top:10px;">
      <div class="k">Amount</div>
      <div class="v" id="payAmountLabel">—</div>
    </div>

    <hr class="soft">

    <div class="ok">
      <b>After payment:</b> Email your <b>transaction hash (TXID)</b> + a screenshot to <b>tcgexpertpro@gmail.com</b>.
      Delivery (UK): <b>5–7 days</b> after final payment is confirmed.
    </div>

    <label class="small" style="margin-top:12px;"><b>TXID / Transaction hash</b> (paste after you pay)</label>
    <input id="txidInput" placeholder="Paste TXID here (optional but recommended)" class="mono">

    <div class="btn-grid" style="margin-top:10px;">
      <button class="btn green" onclick="emailTxid()">Email TXID</button>
      <button class="btn alt" onclick="saveProof()">Save Proof (local)</button>
      <button class="btn gray" onclick="closeCheckout()">Done</button>
      <button class="btn" onclick="openEtherscan()">Open Etherscan</button>
    </div>

    <p class="small" style="margin-top:10px;opacity:.75;">
      Note: Amount is shown as <b>GBP-equivalent</b>. You pay the <b>equivalent in USDT</b> from your wallet/exchange at time of payment.
    </p>
  </div>
</div>

<!-- Drawer -->
<div class="drawer" id="drawer">
  <a href="#verify" onclick="toggleDrawer()">Verify PSA Cert</a>
  <a href="#top" onclick="toggleDrawer()">Top-Selling Pokémon</a>
  <a href="#live" onclick="toggleDrawer()">Live Listings</a>
  <a href="#cross" onclick="toggleDrawer()">Cross-Check Tools</a>
  <a href="#raw" onclick="toggleDrawer()">Raw Valuable Pokémons</a>
  <a href="#flip" onclick="toggleDrawer()">Flip Finder</a>

  <a href="#broker" onclick="toggleDrawer()">Source a PSA Card</a>
  <a href="#seller" onclick="toggleDrawer()">Seller Submit</a>

  <!-- BONUS -->
  <a href="bonus-safe-flip.html" target="_blank" rel="noopener" onclick="toggleDrawer()">Bonus: Safe Flip List</a>

  <a href="#edu" onclick="toggleDrawer()">Educational Links</a>
  <a href="#grading" onclick="toggleDrawer()">Grading Services</a>
  <a href="#faqSection" onclick="toggleDrawer()">FAQ</a>
  <a href="#contact" onclick="toggleDrawer()">Contact Us</a>
</div>

<header>
  <div class="left-header">
    <div class="menu-btn" onclick="toggleDrawer()">☰</div>

    <img class="header-logo"
         src="https://i.ibb.co/WW7tGWYp/IMG-20260110-WA0001.jpg"
         alt="TCG Expert Pro"
         onerror="this.onerror=null;this.src='logo-192.png';">
    <div class="badge">PRO</div>
  </div>

  <div class="sw-indicator" title="Service Worker status">
    <span id="swDot" class="sw-dot"></span>
    <span id="swText" class="sw-text">Worker: Checking…</span>
  </div>
</header>

<!-- Toolkit -->
<section class="reveal">
  <div class="card hero-card">
    <img class="toolkit-img"
         src="https://i.ibb.co/0Rh2fyz9/IMG-20260110-WA0002.jpg"
         alt="Toolkit"
         onerror="this.onerror=null;this.src='toolkit.png';">
    <div class="small" style="margin-top:10px;">
      Offline-ready toolkit • Fast checks • Better buying decisions
    </div>
  </div>
</section>

<!-- Verify PSA -->
<section id="verify" class="reveal">
  <h2>Verify a PSA Certification</h2>

  <div class="card">
    <p>Enter a PSA cert number and open the official cert page.</p>
    <input id="psaCert" placeholder="Enter PSA cert number (e.g. 4050312)">
    <div class="btn-grid">
      <button class="btn green" onclick="verifyPSA()">Verify Cert</button>
      <a class="btn alt" href="https://www.psacard.com/auctionprices" target="_blank" rel="noopener">PSA Realized</a>
      <a class="btn gray" href="https://www.psacard.com/auctionprices/search?category=4" target="_blank" rel="noopener">APR Search</a>
      <a class="btn" href="https://www.psacard.com/pop/tcg-cards/156940" target="_blank" rel="noopener">PSA Pop</a>
    </div>

    <p class="small" style="margin-top:10px;">
      Note: Not all PSA certs show scans. A missing scan is not automatically a fake.
    </p>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px;">Offline Status</h3>
    <p class="small" style="margin-top:0;">
      If you see “Worker: Error”, it usually means <b>sw.js</b> isn’t in the folder or you’re opening via <b>file://</b>.
      Use a local server or GitHub Pages to enable Worker.
    </p>
    <div class="small" id="offlineInfo">Checking…</div>
  </div>
</section>

<!-- Top-Selling Pokémon -->
<section id="top" class="reveal">
  <h2>Top-Selling Pokémon</h2>
  <div class="poke-grid">
    <div class="poke-box" onclick="poke('Charizard')">Charizard</div>
    <div class="poke-box" onclick="poke('Blastoise')">Blastoise</div>
    <div class="poke-box" onclick="poke('Venusaur')">Venusaur</div>
    <div class="poke-box" onclick="poke('Pikachu')">Pikachu</div>
    <div class="poke-box" onclick="poke('Lugia')">Lugia</div>
    <div class="poke-box" onclick="poke('Rayquaza')">Rayquaza</div>
    <div class="poke-box" onclick="poke('Mewtwo')">Mewtwo</div>
    <div class="poke-box" onclick="poke('Gengar')">Gengar</div>
    <div class="poke-box" onclick="poke('Umbreon')">Umbreon</div>
    <div class="poke-box" onclick="poke('Espeon')">Espeon</div>
  </div>
</section>

<!-- Live Listings -->
<section id="live" class="reveal">
  <h2>Live Listings</h2>

  <div class="card">
    <div class="step-panel">
      <div style="font-weight:900;letter-spacing:.2px;">Fast Workflow (3 steps)</div>
      <ol class="steps">
        <li><b>Type your card</b> (example: “Charizard shadowless holo”).</li>
        <li>Tap <b>Generate Comps</b> → then open <b>Sold UK</b> / <b>Sold Worldwide</b> / databases.</li>
        <li>Use <b>Listing Grader</b> + <b>Deal Score</b> + Save to <b>Watchlist</b>.</li>
      </ol>
    </div>

    <hr class="soft">

    <p><b>Search</b> (use keywords for better results)</p>
    <input id="pokeSearch" placeholder="Enter Pokémon (e.g. Charizard shadowless holo)" autocomplete="off">

    <div class="chips" aria-label="Quick keywords">
      <div class="chip" onclick="addKeyword('raw')">raw</div>
      <div class="chip" onclick="addKeyword('1st edition')">1st edition</div>
      <div class="chip" onclick="addKeyword('shadowless')">shadowless</div>
      <div class="chip" onclick="addKeyword('holo')">holo</div>
      <div class="chip" onclick="addKeyword('near mint')">near mint</div>
      <div class="chip" onclick="addKeyword('PSA')">PSA</div>
      <div class="chip" onclick="addKeyword('graded')">graded</div>
    </div>

    <div class="btn-grid" style="margin-top:12px;">
      <button class="btn green" onclick="generateComps()">Generate Comps</button>
      <button class="btn gray" onclick="clearSearch()">Clear</button>
      <button class="btn alt" onclick="scrollToCompBuilder()">Go to Comp Builder</button>
      <button class="btn" onclick="scrollToListingGrader()">Go to Listing Grader</button>
    </div>

    <div class="pill-mini" id="activeQueryPill" style="margin-top:10px;">No active query</div>

    <hr class="soft">

    <p><b>Live Listings</b> (asking prices)</p>
    <div class="btn-grid">
      <button class="btn" onclick="searchLive('ebayuk')">eBay UK Live</button>
      <button class="btn alt" onclick="searchLive('ebayww')">eBay Worldwide Live</button>
      <button class="btn green" onclick="searchLive('vinted')">Vinted UK Live</button>
      <a class="btn gray" href="https://www.psacard.com/auctionprices/search?category=4" target="_blank" rel="noopener">APR Search</a>
    </div>

    <hr class="soft">

    <p><b>Sold Prices (Comps)</b> (real market)</p>
    <div class="btn-grid">
      <button class="btn gray" onclick="searchSold('ebayuk')">eBay Sold UK</button>
      <button class="btn alt" onclick="searchSold('ebayww')">eBay Sold Worldwide</button>
      <button class="btn green" onclick="searchSold('vinted')">Vinted UK Sold</button>
      <a class="btn gray" href="https://130point.com/sales/" target="_blank" rel="noopener">130Point</a>
      <a class="btn alt" href="https://www.pricecharting.com/category/pokemon-cards" target="_blank" rel="noopener">PriceCharting</a>
      <a class="btn green" href="https://app.getcollectr.com/" target="_blank" rel="noopener">Collectr</a>
    </div>

    <hr class="soft">

    <h3 style="margin:0 0 8px;">One-Tap Comp Builder</h3>
    <p class="small" style="margin-top:0;">
      Tap <b>Generate Comps</b> first. Then open the exact sources instantly.
    </p>

    <div id="compBuilder" class="small">
      <span class="pill-mini">Step 1:</span> Type a search term above →
      <span class="pill-mini">Step 2:</span> Tap <b>Generate Comps</b>
    </div>

    <hr class="soft">

    <h3 style="margin:0 0 8px;">Saved Watchlist</h3>
    <p class="small" style="margin-top:0;">Save searches + notes. Re-open comps in one tap. Stored locally on your device.</p>

    <input id="wlNote" placeholder="Optional note (e.g. 'aim PSA 9, watch under £350')">
    <div class="btn-grid">
      <button class="btn green" onclick="watchlistSaveFromInput()">Save This Search</button>
      <button class="btn gray" onclick="watchlistClearAll()">Clear All</button>
      <button class="btn alt" onclick="renderWatchlist()">Refresh</button>
      <button class="btn" onclick="scrollToTop()">Top</button>
    </div>
    <div class="pill-mini" id="wlCount" style="margin-top:10px;">0 saved</div>

    <div id="watchlist" class="small" style="margin-top:12px;">No saved searches yet.</div>

    <hr class="soft">

    <h3 style="margin:0 0 8px;">Listing Quality Grader (Ultra Premium)</h3>
    <p class="small" style="margin-top:0;">
      Tick what the listing shows. This outputs a <b>Confidence</b> rating + next action.
    </p>

    <div id="lqWrap"></div>

    <div class="btn-grid" style="margin-top:10px;">
      <button class="btn green" onclick="calcListingGrade()">Grade Listing</button>
      <button class="btn gray" onclick="resetListingGrade()">Reset</button>
      <button class="btn alt" onclick="saveChecklist()">Save Checklist</button>
      <button class="btn" onclick="printChecklist()">Print</button>
    </div>

    <div class="score-wrap" id="lqOut" style="margin-top:12px;">
      <div class="score-top">
        <div class="score-title">Confidence: <span id="lqScore">—</span></div>
        <div class="score-grade" id="lqLabel">—</div>
      </div>
      <div class="score-bar"><div class="score-fill" id="lqFill"></div></div>
      <div class="score-hint" id="lqHint">Tick items and press “Grade Listing”.</div>
    </div>

  </div>

  <div class="card">
    <h3 style="margin:0 0 8px;">Deal Calculator</h3>
    <p class="small" style="margin-top:0;">
      Estimate total costs + ROI before you buy. Saved locally.
    </p>

    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <div style="flex:1;min-width:160px;">
        <label class="small">Buy price (£)</label>
        <input id="dc_buy" type="number" inputmode="decimal" placeholder="e.g. 250">
      </div>
      <div style="flex:1;min-width:160px;">
        <label class="small">Expected sale (£)</label>
        <input id="dc_sale" type="number" inputmode="decimal" placeholder="e.g. 600">
      </div>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <div style="flex:1;min-width:160px;">
        <label class="small">Grading + shipping (£)</label>
        <input id="dc_grade" type="number" inputmode="decimal" placeholder="e.g. 45">
      </div>
      <div style="flex:1;min-width:160px;">
        <label class="small">Fees % (selling platform)</label>
        <input id="dc_feePct" type="number" inputmode="decimal" placeholder="e.g. 12">
      </div>
    </div>

    <div class="btn-grid">
      <button class="btn green" onclick="calcDeal()">Calculate</button>
      <button class="btn gray" onclick="resetDeal()">Reset</button>
      <button class="btn alt" onclick="saveDealInputs()">Save</button>
      <button class="btn" onclick="loadDealInputs();">Load</button>
    </div>

    <hr class="soft">
    <div id="dc_out" class="small">Enter numbers and hit Calculate.</div>

    <div class="score-wrap" id="dealScoreWrap" style="display:none;">
      <div class="score-top">
        <div class="score-title">Deal Score: <span id="dealScoreValue">0</span>/100</div>
        <div class="score-grade" id="dealScoreGrade">—</div>
      </div>
      <div class="score-bar"><div class="score-fill" id="dealScoreFill"></div></div>
      <div class="score-hint" id="dealScoreHint">—</div>
    </div>
  </div>
</section>

<!-- Cross-Check Tools -->
<section id="cross" class="reveal">
  <h2>Cross-Check Tools</h2>
  <p class="sub">Use these for extra pricing context and research.</p>
  <div class="poke-grid">
    <div class="poke-box" onclick="go('https://pokescope.app/pokemon-card-value/')">PokeScope</div>
    <div class="poke-box" onclick="go('https://www.pokedata.io/')">PokeData</div>
    <div class="poke-box" onclick="go('https://pokecardvalues.co.uk/')">Poke Card Values</div>
    <div class="poke-box" onclick="go('https://pokecardvalues.co.uk/prices/psa10/')">Poke Card Values (PSA 10)</div>
    <div class="poke-box" onclick="go('https://www.pricecharting.com/category/pokemon-cards')">PriceCharting</div>
    <div class="poke-box" onclick="go('https://130point.com/sales/')">130Point</div>
    <div class="poke-box" onclick="go('https://www.tcgplayer.com/categories/trading-and-collectible-card-games/pokemon/price-guides')">TCG Player</div>
    <div class="poke-box" onclick="go('https://app.getcollectr.com/')">Collectr</div>
  </div>
</section>

<!-- Raw Valuable Pokémons -->
<section id="raw" class="reveal">
  <h2>Raw Valuable Pokémons</h2>
  <p class="sub">Use these searches to find raw Pokémon gems.</p>
  <div class="card">
    <select id="rawSelect">
      <option value="" selected disabled>Select a search...</option>
      <option>Pokemon 1st Edition Base Set Charizard Holo raw</option>
      <option>Pokemon 1st Edition Base Set Blastoise Holo raw</option>
      <option>Pokemon 1st Edition Base Set Venusaur Holo raw</option>
      <option>Pokemon Base Set Shadowless Ninetales Holo raw</option>
      <option>Pokemon Base Set Shadowless Mewtwo Holo raw</option>
      <option>Pokemon Base Set Holo Gyarados raw</option>
      <option>Pokemon Victory Cup 3rd Place raw</option>
      <option>Pokemon No.2 Trainer Neo Spring Battle raw</option>
      <option>Pokemon Ancient Mew Japanese raw</option>
      <option>Pokemon Promo Kangaskhan raw</option>
      <option>Pokemon Gold Star Rayquaza raw</option>
      <option>Pokemon Gold Star Pikachu raw</option>
      <option>Pokemon Gold Star Gyarados raw</option>
      <option>Umbreon ex PRE-161 raw Pokemon</option>
      <option>Mega Charizard X ex raw Pokemon</option>
      <option>Lillie's Clefairy ex raw Pokemon</option>
      <option>Rayquaza ex raw Pokemon</option>
      <option>Pokemon Charizard alternate art raw</option>
      <option>Pokemon Umbreon alternate art raw</option>
      <option>Pokemon Shining Fates Charizard raw</option>
    </select>
    <div class="btn-grid">
      <button class="btn alt" onclick="openRawSearch()">Open eBay Search</button>
      <button class="btn gray" onclick="document.getElementById('rawSelect').selectedIndex=0;">Reset</button>
      <button class="btn green" onclick="go('#broker')">Source PSA (We Buy + Ship)</button>
      <button class="btn" onclick="go('#flip')">Use Flip Finder</button>
    </div>
  </div>
</section>

<!-- Flip Finder -->
<section id="flip" class="reveal">
  <h2>Flip Finder</h2>
  <p class="sub">Pick a target — then jump straight to the right marketplaces. Includes quick “how to tell” notes.</p>

  <div class="card">
    <label class="small" for="ffCat"><b>Category</b></label>
    <select id="ffCat"></select>

    <label class="small" for="ffCard" style="margin-top:10px;"><b>Card (Full name)</b></label>
    <select id="ffCard"></select>

    <div class="btn-grid" style="margin-top:12px;">
      <button class="btn gray" onclick="ffEbaySoldUK()">eBay UK — SOLD</button>
      <button class="btn alt" onclick="ffEbayLiveUK()">eBay UK — LIVE</button>
      <button class="btn alt" onclick="ffEbaySoldWW()">eBay Worldwide — SOLD</button>
      <button class="btn green" onclick="ffVinted()">Vinted — Search</button>
    </div>

    <hr class="soft">

    <div class="score-wrap" style="margin-top:0;">
      <div class="score-top">
        <div class="score-title">Quick Reference</div>
        <div class="score-grade" id="ffTagPill">Target</div>
      </div>

      <div id="ffPills" class="chips" style="margin-top:10px;"></div>
      <div class="score-hint" id="ffNotes">Select a card to see notes.</div>
    </div>

    <div class="small" style="margin-top:10px;opacity:.8;">
      Pro tip: use <b>Sold comps</b> first, then validate photos using the <b>Listing Quality Grader</b>.
    </div>
  </div>
</section>

<!-- Source a PSA Card -->
<section id="broker" class="reveal">
  <h2>Source a PSA Card</h2>
  <p class="sub">
    PSA 1–PSA 10 without the guesswork. You tell us what you want — we source, buy, perform visual verification, and ship to you.
    <b>USDT (Tether) — Ethereum (ERC-20) only.</b>
  </p>

  <div class="card">
    <div class="step-panel">
      <div style="font-weight:900;letter-spacing:.2px;">How it works</div>
      <ol class="steps">
        <li>Submit your target card + grade + max budget.</li>
        <li>Pay the <b>Broker Deposit</b> (non-refundable, credited toward the final total).</li>
        <li>We source options based on recent sold prices and availability.</li>
        <li>We buy the card, then perform <b>visual verification</b> and may use a local trading card shop to check for obvious counterfeit indicators.</li>
        <li>You pay the final total (includes handling + insured shipping). Delivery UK: <b>5–7 days</b>.</li>
      </ol>
    </div>

    <hr class="soft">

    <div class="alert">
      <b>Verification note:</b> This is not a grading or certification service. We do not guarantee grades or authenticate to PSA standards.
      We perform visual checks and, where available, a local shop may confirm the item appears consistent with genuine examples.
    </div>

    <hr class="soft">

    <h3 style="margin:0 0 8px;">Request Form</h3>

    <label class="small"><b>Your email</b> (for updates)</label>
    <input id="br_email" placeholder="your@email.com" inputmode="email">

    <label class="small"><b>Card</b> (exact name)</label>
    <input id="br_card" placeholder="e.g. Charizard Base Set Holo 4/102">

    <label class="small"><b>Grade target</b></label>
    <select id="br_grade">
      <option value="PSA 1">PSA 1</option><option value="PSA 2">PSA 2</option><option value="PSA 3">PSA 3</option>
      <option value="PSA 4">PSA 4</option><option value="PSA 5">PSA 5</option><option value="PSA 6">PSA 6</option>
      <option value="PSA 7">PSA 7</option>
      <option value="PSA 8" selected>PSA 8</option>
      <option value="PSA 9">PSA 9</option><option value="PSA 10">PSA 10</option>
    </select>

    <label class="small"><b>Max budget (£)</b></label>
    <input id="br_budget" type="number" inputmode="decimal" placeholder="e.g. 1200">

    <label class="small"><b>Urgency</b></label>
    <select id="br_urgency">
      <option value="Standard (7 days)">Standard (7 days)</option>
      <option value="Priority (48 hours)">Priority (48 hours)</option>
    </select>

    <label class="small"><b>Notes</b> (optional)</label>
    <textarea id="br_notes" rows="3" placeholder="e.g. English only, strong centering, no scratches, specific set symbol, etc."></textarea>

    <hr class="soft">

    <div class="kv">
      <div class="k">Broker Deposit</div>
      <div class="v"><b>£39.99</b> (pay equivalent in USDT)</div>
    </div>

    <div class="btn-grid" style="margin-top:12px;">
      <button class="btn green" onclick="submitBrokerRequest()">Submit Request</button>
      <button class="btn alt" onclick="openCheckout('Broker Deposit (credited)', '£39.99 equivalent in USDT')">Pay Broker Deposit</button>
      <button class="btn gray" onclick="prefillFromSearch()">Use my current search</button>
      <button class="btn" onclick="emailBrokerRequest()">Email request</button>
    </div>

    <p class="small" style="margin-top:10px;opacity:.78;">
      Deposit is <b>non-refundable</b> and credited toward the final total if we proceed. Final total includes sourcing/handling and insured UK shipping.
    </p>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px;">UK Insured Shipping (added at checkout)</h3>
    <p class="small" style="margin-top:0;">Final invoice includes insured shipping based on card value.</p>
    <div class="kv"><div class="k">Up to £1,000</div><div class="v">£25</div></div>
    <div class="kv" style="margin-top:10px;"><div class="k">Up to £2,500</div><div class="v">£75</div></div>
    <div class="kv" style="margin-top:10px;"><div class="k">Up to £5,000</div><div class="v">£135</div></div>
    <div class="kv" style="margin-top:10px;"><div class="k">Up to £10,000</div><div class="v">£290</div></div>
    <p class="small" style="margin-top:10px;opacity:.78;">
      Shipping includes tracking and insurance up to the selected value band. Selecting the wrong band may void cover.
    </p>
  </div>
</section>

<!-- Seller Submit -->
<section id="seller" class="reveal">
  <h2>Seller Submit</h2>
  <p class="sub">Want to sell a Pokémon card? Submit your details and we’ll attempt to find a buyer within <b>7 days</b>. <b>£6.99 equivalent in USDT</b>. No refund.</p>

  <div class="card">
    <div class="alert">
      <b>No refund:</b> Seller Submit is a marketing and outreach service. We do not guarantee a sale.
    </div>

    <hr class="soft">

    <label class="small"><b>Your email</b></label>
    <input id="ss_email" placeholder="your@email.com" inputmode="email">

    <label class="small"><b>Card</b></label>
    <input id="ss_card" placeholder="e.g. Charizard Base Set Holo 4/102">

    <label class="small"><b>Condition / grade</b></label>
    <input id="ss_grade" placeholder="e.g. Raw NM / PSA 8 / PSA 9">

    <label class="small"><b>Desired price (£)</b> (optional)</label>
    <input id="ss_price" type="number" inputmode="decimal" placeholder="e.g. 950">

    <label class="small"><b>Notes</b> (optional)</label>
    <textarea id="ss_notes" rows="3" placeholder="e.g. includes cert number, close-ups available, set, language, etc."></textarea>

    <div class="kv" style="margin-top:12px;">
      <div class="k">Seller Submit fee</div>
      <div class="v"><b>£6.99</b> (pay equivalent in USDT)</div>
    </div>

    <div class="btn-grid" style="margin-top:12px;">
      <button class="btn green" onclick="saveSellerSubmit()">Save Submission</button>
      <button class="btn alt" onclick="openCheckout('Seller Submit (no refund)', '£6.99 equivalent in USDT')">Pay Seller Submit</button>
      <button class="btn gray" onclick="emailSellerSubmit()">Email submission</button>
      <button class="btn" onclick="go('#live')">Build comps first</button>
    </div>
  </div>
</section>

<!-- Educational Links -->
<section id="edu" class="reveal">
  <h2>Educational Links</h2>

  <div class="card">
    <div class="btn-grid">
      <a class="btn" href="https://support.psacard.com/s/article/verify-cert" target="_blank" rel="noopener">Verify PSA Cert</a>
      <a class="btn alt" href="https://www.psacard.com/gradingstandards" target="_blank" rel="noopener">PSA Grading Scale</a>
      <a class="btn gray" href="https://www.pokemon.com/uk/pokemon-tcg/pokemon-cards" target="_blank" rel="noopener">Official Card DB</a>
      <a class="btn green" href="https://acegrading.com/cert" target="_blank" rel="noopener">ACE Cert Lookup</a>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px;">Grading Prep Checklist (Offline)</h3>
    <p class="small" style="margin-top:0;">
      Tick items as you prep. Saved locally. Print when ready.
    </p>

    <div id="checklist"></div>

    <div class="btn-grid" style="margin-top:10px;">
      <button class="btn green" onclick="saveChecklist()">Save</button>
      <button class="btn gray" onclick="resetChecklist()">Reset</button>
      <button class="btn alt" onclick="printChecklist()">Print</button>
      <button class="btn" onclick="go('#verify')">Verify PSA</button>
    </div>
  </div>
</section>

<section id="grading" class="reveal">
  <h2>Grading Services</h2>
  <div class="card">
    <div class="btn-grid">
      <a class="btn" href="https://www.psacard.com/services/tradingcardgrading" target="_blank" rel="noopener">PSA</a>
      <a class="btn alt" href="https://www.cgccards.uk/" target="_blank" rel="noopener">CGC</a>
      <a class="btn green" href="https://www.beckett.com/grading" target="_blank" rel="noopener">Beckett</a>
      <a class="btn gray" href="https://acegrading.com/" target="_blank" rel="noopener">ACE</a>
    </div>
  </div>
</section>

<section id="faqSection" class="reveal">
  <h2>FAQ</h2>
  <div class="card">
    <h3>What is TCG Expert Pro?</h3>
    <p>TCG Expert Pro is a toolkit to verify PSA cards, check live/sold prices, and spot fake Pokémon cards.</p>
    <h3>How to use TCG Expert Pro?</h3>
    <p>Use the sections above: Verify PSA, Live Listings, Comps, Watchlist, Deal Score, Listing Grader, Checklist.</p>
    <h3>What is “Source a PSA Card”?</h3>
    <p>You submit the exact card + grade + budget. We source and buy the card, perform visual verification, then ship it to you. Payment is USDT (ERC-20) only.</p>
    <h3>Do you guarantee authenticity or grade?</h3>
    <p>No. We perform visual checks and may use a local trading card shop for a basic consistency check. This is not a grading/certification service.</p>
  </div>
</section>

<section id="contact" class="reveal">
  <h2>Contact Us</h2>
  <div class="card">
    <p style="margin:0;line-height:1.6;">
      Contact us should you have any questions.<br>
      Email: <b>tcgexpertpro@gmail.com</b>
    </p>
  </div>
</section>

<footer style="background:#0e1320;color:#eaeaea;padding:20px;text-align:center;font-size:13px;border-top:1px solid rgba(255,255,255,.06);">
  <p>© 2026 TCG Expert Pro</p>
</footer>

<!-- Cookies Popup -->
<div id="cookiePopup" class="cookie-popup" aria-live="polite">
  <div class="cookie-row">
    <div class="cookie-text">
      <b>Cookies</b><br>
      This tool uses cookies/local storage to remember your preferences. Accept or decline.
    </div>
    <div class="cookie-actions">
      <button class="btn gray" onclick="setCookieChoice('declined')">Decline</button>
      <button class="btn green" onclick="setCookieChoice('accepted')">Accept</button>
    </div>
  </div>
</div>

<button id="toTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑ Top</button>

<script>
/* Drawer */
function toggleDrawer(){document.getElementById('drawer').classList.toggle('open');}

/* PSA */
function verifyPSA(){
  const n=document.getElementById('psaCert').value.trim();
  if(n) window.open(`https://www.psacard.com/cert/${n}`,'_blank');
}

/* Top Pokémon quick search */
function poke(name){
  window.open(`https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(name+" pokemon card")}`,'_blank');
}

/* Open URL */
function go(url){
  if(String(url).startsWith("#")){
    const el = document.querySelector(url);
    if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
    return;
  }
  window.open(url,'_blank');
}

/* Listings */
function searchLive(type){
  const q=document.getElementById('pokeSearch').value.trim();
  if(!q){alert("Type a search term first.");return;}
  if(type==='ebayuk')window.open(`https://www.ebay.co.uk/sch/i.html?_nkw=${encodeURIComponent(q)}&LH_Sold=0`,'_blank');
  if(type==='ebayww')window.open(`https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(q)}&LH_Sold=0`,'_blank');
  if(type==='vinted')window.open(`https://www.vinted.co.uk/catalog?search_text=${encodeURIComponent(q)}`,'_blank');
}
function searchSold(type){
  const q=document.getElementById('pokeSearch').value.trim();
  if(!q){alert("Type a search term first.");return;}
  if(type==='ebayuk')window.open(`https://www.ebay.co.uk/sch/i.html?_nkw=${encodeURIComponent(q)}&LH_Sold=1&LH_Complete=1`,'_blank');
  if(type==='ebayww')window.open(`https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(q)}&LH_Sold=1&LH_Complete=1`,'_blank');
  if(type==='vinted')window.open(`https://www.vinted.co.uk/catalog?search_text=${encodeURIComponent(q)}`,'_blank');
}

/* Raw valuable dropdown */
function openRawSearch(){
  const sel=document.getElementById('rawSelect');
  if(!sel || !sel.value){ alert("Select a search first."); return; }
  const term=encodeURIComponent(sel.value);
  window.open(`https://www.ebay.co.uk/sch/i.html?_nkw=${term}&_sacat=0`,'_blank');
}

/* Cookies */
function setCookieChoice(choice){
  try{ localStorage.setItem('tcg_cookie_choice', choice); }catch(e){}
  const pop=document.getElementById('cookiePopup');
  if(pop) pop.classList.remove('show');
}
(function initCookiePopup(){
  try{
    const choice=localStorage.getItem('tcg_cookie_choice');
    if(!choice){
      const pop=document.getElementById('cookiePopup');
      if(pop) setTimeout(()=>pop.classList.add('show'), 900);
    }
  }catch(e){}
})();

/* Back to Top visibility */
(function(){
  const btn = document.getElementById('toTop');
  function onScroll(){
    if(!btn) return;
    btn.style.display = (window.scrollY > 700) ? 'block' : 'none';
  }
  window.addEventListener('scroll', onScroll, {passive:true});
  onScroll();
})();

/* Service worker indicator */
function setSwStatus(state){
  const dot=document.getElementById('swDot');
  const txt=document.getElementById('swText');
  if(!dot||!txt) return;
  if(state==='live'){ dot.style.background='#8cff00'; dot.style.boxShadow='0 0 12px rgba(140,255,0,.55)'; txt.textContent='Worker Live'; return; }
  if(state==='install'){ dot.style.background='#ffcc00'; dot.style.boxShadow='0 0 12px rgba(255,204,0,.35)'; txt.textContent='Worker: Installing…'; return; }
  if(state==='error'){ dot.style.background='#ff3b3b'; dot.style.boxShadow='0 0 12px rgba(255,59,59,.35)'; txt.textContent='Worker: Error'; return; }
  dot.style.background='#666'; dot.style.boxShadow='none'; txt.textContent='Worker: Checking…';
}
(function initSW(){
  const info = document.getElementById("offlineInfo");
  const isFile = location.protocol === "file:";
  const msgFile = isFile
    ? "Opened via file:// — Worker cannot control pages this way. Use a local server OR GitHub Pages to enable Worker."
    : "Opened via http/https — Worker can work (if sw.js exists).";

  if(info) info.textContent = msgFile;

  if(!('serviceWorker' in navigator)){
    setSwStatus('error');
    return;
  }

  if(navigator.serviceWorker.controller) setSwStatus('live');
  else setSwStatus('install');

  navigator.serviceWorker.register('sw.js')
    .then(()=>{
      navigator.serviceWorker.addEventListener('controllerchange', ()=>setSwStatus('live'));
      setTimeout(()=>{
        if(navigator.serviceWorker.controller) setSwStatus('live');
        else if(location.protocol === "file:") setSwStatus('error');
      }, 1200);
    })
    .catch(()=>{ setSwStatus('error'); });
})();

/* Search UX helpers */
function setActivePill(q){
  const pill = document.getElementById("activeQueryPill");
  if(!pill) return;
  pill.textContent = q ? `Active: ${q}` : "No active query";
}
function addKeyword(word){
  const inp = document.getElementById("pokeSearch");
  if(!inp) return;
  const cur = (inp.value || "").trim();
  inp.value = cur ? `${cur} ${word}` : word;
  inp.focus();
}
function clearSearch(){
  const inp = document.getElementById("pokeSearch");
  if(inp) inp.value = "";
  window.__lastCompQuery = "";
  setActivePill("");
  renderCompBuilder();
}
function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}); }
function scrollToCompBuilder(){ document.getElementById("compBuilder")?.scrollIntoView({behavior:"smooth", block:"start"}); }
function scrollToListingGrader(){ document.getElementById("lqWrap")?.scrollIntoView({behavior:"smooth", block:"start"}); }

/* Comp builder */
function getCompLinks(q){
  const term = encodeURIComponent(q);
  return {
    ebaySoldUK: `https://www.ebay.co.uk/sch/i.html?_nkw=${term}&LH_Sold=1&LH_Complete=1`,
    ebaySoldWW: `https://www.ebay.com/sch/i.html?_nkw=${term}&LH_Sold=1&LH_Complete=1`,
    pricecharting: `https://www.pricecharting.com/search-products?type=prices&q=${term}`,
    tcgplayer: `https://www.tcgplayer.com/search/pokemon/product?productLineName=pokemon&q=${term}`,
    collectr: `https://app.getcollectr.com/search?q=${term}`,
    points130: `https://130point.com/sales/`
  };
}
function generateComps(){
  const q = document.getElementById("pokeSearch")?.value?.trim() || "";
  if(!q){ alert("Type a search term first."); return; }
  window.__lastCompQuery = q;
  setActivePill(q);
  renderCompBuilder();
}
function renderCompBuilder(){
  const box = document.getElementById("compBuilder");
  if(!box) return;

  const q = window.__lastCompQuery || "";
  if(!q){
    box.innerHTML = `
      <div class="step-panel">
        <div class="small"><span class="pill-mini">Step 1:</span> Type a search term → <span class="pill-mini">Step 2:</span> Tap <b>Generate Comps</b></div>
      </div>
    `;
    return;
  }

  box.innerHTML = `
    <div class="step-panel">
      <div class="small"><b>Query:</b> ${escapeHtml(q)}</div>
      <div class="btn-grid" style="margin-top:10px;">
        <button class="btn alt" onclick="openComp('ebaySoldUK')">eBay UK Sold</button>
        <button class="btn alt" onclick="openComp('ebaySoldWW')">eBay Worldwide Sold</button>
        <button class="btn gray" onclick="openComp('points130')">130Point</button>
        <button class="btn gray" onclick="openComp('pricecharting')">PriceCharting</button>
        <button class="btn green" onclick="openComp('tcgplayer')">TCGPlayer</button>
        <button class="btn green" onclick="openComp('collectr')">Collectr</button>
        <button class="btn" onclick="openAllComps()">Open All</button>
        <button class="btn" onclick="prefillBrokerFromQuery()">Send to Source PSA</button>
      </div>
      <div class="small" style="margin-top:10px;opacity:.82;">
        Pro tip: Use Sold comps first. If it’s a raw card, confirm photos using the Listing Grader below.
      </div>
    </div>
  `;
}
function openComp(key){
  const q = window.__lastCompQuery || document.getElementById("pokeSearch")?.value?.trim() || "";
  if(!q){ alert("Type a search term first."); return; }
  const links = getCompLinks(q);
  const url = links[key];
  if(url) window.open(url, "_blank");
}
function openAllComps(){
  const q = window.__lastCompQuery || document.getElementById("pokeSearch")?.value?.trim() || "";
  if(!q){ alert("Type a search term first."); return; }
  const links = getCompLinks(q);
  [links.ebaySoldUK, links.ebaySoldWW, links.points130, links.pricecharting, links.tcgplayer, links.collectr].forEach(u=>window.open(u,"_blank"));
}

/* Watchlist */
const WL_KEY = "tcg_watchlist_v1";
function wlLoad(){ try{ const raw=localStorage.getItem(WL_KEY); return raw?JSON.parse(raw):[]; }catch(e){ return []; } }
function wlSave(list){ try{ localStorage.setItem(WL_KEY, JSON.stringify(list)); }catch(e){} }
function wlSetCount(n){ const el=document.getElementById("wlCount"); if(el) el.textContent = `${n} saved`; }

function watchlistSaveFromInput(){
  const q = (window.__lastCompQuery || document.getElementById("pokeSearch")?.value?.trim() || "");
  if(!q){ alert("Type a search term first, then press Generate Comps."); return; }
  const note = document.getElementById("wlNote")?.value?.trim() || "";

  const list = wlLoad();
  const exists = list.some(x => (x.query || "").toLowerCase() === q.toLowerCase());
  if(exists){ alert("That search is already saved."); return; }

  list.unshift({ id:String(Date.now()), query:q, note:note, created:new Date().toISOString() });
  wlSave(list);

  if(document.getElementById("wlNote")) document.getElementById("wlNote").value = "";
  renderWatchlist();
}
function watchlistDelete(id){
  const list = wlLoad().filter(x => x.id !== id);
  wlSave(list);
  renderWatchlist();
}
function watchlistClearAll(){
  if(!confirm("Clear all saved watchlist items?")) return;
  wlSave([]);
  renderWatchlist();
}
function watchlistOpenComps(query){
  if(!query) return;
  window.__lastCompQuery = query;
  setActivePill(query);
  renderCompBuilder();
  openAllComps();
}
function watchlistOpenSoldUK(query){
  if(!query) return;
  const links = getCompLinks(query);
  window.open(links.ebaySoldUK, "_blank");
}
function renderWatchlist(){
  const wrap = document.getElementById("watchlist");
  if(!wrap) return;

  const list = wlLoad();
  wlSetCount(list.length);

  if(list.length === 0){
    wrap.innerHTML = "No saved searches yet.";
    return;
  }

  wrap.innerHTML = list.map(item=>{
    const q = item.query || "";
    const note = item.note || "";
    return `
      <div class="watch-row">
        <div class="watch-left">
          <div class="watch-title">${escapeHtml(q)}</div>
          ${note ? `<div class="watch-note">${escapeHtml(note)}</div>` : `<div class="watch-note">—</div>`}
        </div>
        <div class="watch-actions">
          <button class="btn alt" onclick="watchlistOpenSoldUK(${JSON.stringify(q)})">Sold UK</button>
          <button class="btn" onclick="watchlistOpenComps(${JSON.stringify(q)})">Open Comps</button>
          <button class="btn gray" onclick="watchlistDelete('${item.id}')">Delete</button>
        </div>
      </div>
    `;
  }).join("");
}

/* Listing grader */
const LQ_KEY = "tcg_listing_grader_v1";
const LQ_ITEMS = [
  {id:"lq_frontback", label:"Clear front + back photos (no blur)"},
  {id:"lq_lighting", label:"Good lighting (true colors, no heavy shadows)"},
  {id:"lq_edges", label:"Edges/corners visible (close-ups or sharp crop)"},
  {id:"lq_holo", label:"Holo/foil angle shown (if holo)"},
  {id:"lq_surface", label:"Surface condition visible (scratches / print lines)"},
  {id:"lq_seller", label:"Seller looks trustworthy (feedback / history / clean listing)"},
  {id:"lq_story", label:"Listing description makes sense (no reprint/proxy terms)"},
];
function lqLoad(){ try{ const raw = localStorage.getItem(LQ_KEY); return raw ? JSON.parse(raw) : {}; }catch(e){ return {}; } }
function lqSave(obj){ try{ localStorage.setItem(LQ_KEY, JSON.stringify(obj)); }catch(e){} }
function renderListingGrader(){
  const wrap = document.getElementById("lqWrap");
  if(!wrap) return;

  const st = lqLoad();
  wrap.innerHTML = LQ_ITEMS.map(x=>{
    const checked = !!st[x.id];
    return `
      <div class="check-item">
        <input type="checkbox" id="${x.id}" ${checked?'checked':''}>
        <label for="${x.id}">${x.label}</label>
      </div>
    `;
  }).join("");

  LQ_ITEMS.forEach(x=>{
    const el = document.getElementById(x.id);
    if(el) el.addEventListener("change", ()=>{
      const state = lqLoad();
      state[x.id] = !!el.checked;
      lqSave(state);
    });
  });
}
function calcListingGrade(){
  const st = lqLoad();
  const total = LQ_ITEMS.length;
  const scoreRaw = LQ_ITEMS.reduce((acc,x)=>acc + (st[x.id]?1:0),0);
  const pct = Math.round((scoreRaw/total)*100);

  const fill = document.getElementById("lqFill");
  const score = document.getElementById("lqScore");
  const label = document.getElementById("lqLabel");
  const hint = document.getElementById("lqHint");

  if(fill) fill.style.width = pct + "%";
  if(score) score.textContent = pct + "%";

  let tag="Risky";
  let advice="Not enough info. Ask the seller for better photos, close-ups, and angles before buying.";
  if(pct >= 86){ tag="Elite"; advice="High confidence. Still confirm sold comps and check authenticity indicators."; }
  else if(pct >= 70){ tag="Strong"; advice="Good listing quality. Proceed with comps + deal score. Watch for hidden surface issues."; }
  else if(pct >= 55){ tag="Okay"; advice="Decent, but request close-ups of corners/edges and holo angles before committing."; }
  else if(pct >= 35){ tag="Risky"; advice="Low confidence. Only proceed if you can verify more photos or meet in person."; }
  else { tag="Avoid"; advice="Too many unknowns. High chance of disappointment or counterfeit risk."; }

  if(label) label.textContent = tag;
  if(hint) hint.textContent = advice;
}
function resetListingGrade(){
  try{ localStorage.removeItem(LQ_KEY); }catch(e){}
  renderListingGrader();
  const fill = document.getElementById("lqFill");
  const score = document.getElementById("lqScore");
  const label = document.getElementById("lqLabel");
  const hint = document.getElementById("lqHint");
  if(fill) fill.style.width = "0%";
  if(score) score.textContent = "—";
  if(label) label.textContent = "—";
  if(hint) hint.textContent = "Tick items and press “Grade Listing”.";
}

/* Deal score */
const DEAL_KEY = "tcg_deal_calc_v1";
function readNum(id){
  const el = document.getElementById(id);
  if(!el) return 0;
  const v = parseFloat(el.value);
  return isFinite(v) ? v : 0;
}
function saveDealInputs(){
  try{
    const data = {
      buy: document.getElementById("dc_buy")?.value || "",
      sale: document.getElementById("dc_sale")?.value || "",
      grade: document.getElementById("dc_grade")?.value || "",
      feePct: document.getElementById("dc_feePct")?.value || ""
    };
    localStorage.setItem(DEAL_KEY, JSON.stringify(data));
  }catch(e){}
}
function loadDealInputs(){
  try{
    const raw = localStorage.getItem(DEAL_KEY);
    if(!raw) return;
    const d = JSON.parse(raw);
    if(document.getElementById("dc_buy")) document.getElementById("dc_buy").value = d.buy ?? "";
    if(document.getElementById("dc_sale")) document.getElementById("dc_sale").value = d.sale ?? "";
    if(document.getElementById("dc_grade")) document.getElementById("dc_grade").value = d.grade ?? "";
    if(document.getElementById("dc_feePct")) document.getElementById("dc_feePct").value = d.feePct ?? "";
  }catch(e){}
}
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
function computeDealScore({profit, roi, sale, totalCost}){
  const safeSale = Math.max(1, sale);
  const marginPct = (profit / safeSale) * 100;

  let roiScore = 30 + (roi * 0.65);
  roiScore = clamp(roiScore, 0, 100);

  let mScore = 40 + (marginPct * 1.2);
  mScore = clamp(mScore, 0, 100);

  let penalty = 0;
  if(profit < 0) penalty = clamp(Math.abs(profit) / Math.max(1,totalCost) * 140, 20, 85);

  let score = (roiScore * 0.62) + (mScore * 0.38) - penalty;
  score = clamp(score, 0, 100);

  let grade = "Caution";
  let hint = "Check comps again and avoid overpaying. Consider waiting for better listings.";
  if(score >= 85){ grade="Elite"; hint="Strong upside. Still verify authenticity and recent sold comps before buying."; }
  else if(score >= 70){ grade="Great"; hint="Solid deal potential. Confirm sold comps and fees, then move quickly."; }
  else if(score >= 55){ grade="Okay"; hint="Decent if condition is strong. Double-check comps and target a better entry price."; }
  else if(score >= 35){ grade="Risky"; hint="Thin margins. Only proceed if you’re confident on grade and demand."; }
  else { grade="Avoid"; hint="Low upside or negative profit after fees. Look for a cheaper entry or skip."; }

  return { score: Math.round(score), grade, hint, marginPct: marginPct };
}
function updateDealScoreUI(data){
  const wrap = document.getElementById("dealScoreWrap");
  const val = document.getElementById("dealScoreValue");
  const grade = document.getElementById("dealScoreGrade");
  const fill = document.getElementById("dealScoreFill");
  const hint = document.getElementById("dealScoreHint");
  if(!wrap||!val||!grade||!fill||!hint) return;

  wrap.style.display = "block";
  val.textContent = data.score;
  grade.textContent = data.grade;
  hint.textContent = `${data.hint} (Margin: ${data.marginPct.toFixed(1)}%)`;
  fill.style.width = `${data.score}%`;
}
function calcDeal(){
  const buy = readNum("dc_buy");
  const sale = readNum("dc_sale");
  const gradeCost = readNum("dc_grade");
  const feePct = readNum("dc_feePct");

  const fees = sale * (feePct/100);
  const totalCost = buy + gradeCost + fees;
  const profit = sale - totalCost;
  const roi = totalCost > 0 ? (profit/totalCost)*100 : 0;

  const out = document.getElementById("dc_out");
  if(out){
    out.innerHTML = `
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <span class="pill-mini">Fees: £${fees.toFixed(2)}</span>
        <span class="pill-mini">Total cost: £${totalCost.toFixed(2)}</span>
        <span class="pill-mini" style="border-color:${profit>=0?'rgba(140,255,0,.35)':'rgba(255,59,59,.35)'};">
          Profit: £${profit.toFixed(2)}
        </span>
        <span class="pill-mini">ROI: ${roi.toFixed(1)}%</span>
        <span class="pill-mini">Break-even sale: £${totalCost.toFixed(2)}</span>
      </div>
    `;
  }

  const scoreData = computeDealScore({profit, roi, sale, totalCost});
  updateDealScoreUI(scoreData);
  saveDealInputs();
}
function resetDeal(){
  ["dc_buy","dc_sale","dc_grade","dc_feePct"].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.value="";
  });
  const out=document.getElementById("dc_out");
  if(out) out.textContent="Enter numbers and hit Calculate.";
  const wrap = document.getElementById("dealScoreWrap");
  if(wrap) wrap.style.display="none";
  try{ localStorage.removeItem(DEAL_KEY); }catch(e){}
}

/* Checklist */
const CHECK_KEY="tcg_checklist_v1";
const CHECK_ITEMS=[
  "Front/back photos taken (good lighting)",
  "Centering checked (front + back)",
  "Corners checked (no whitening)",
  "Edges checked (no dings)",
  "Surface checked (scratches / print lines)",
  "Holo checked (pattern + no heavy scratches)",
  "Sleeve used (penny sleeve)",
  "Toploader / semi-rigid used",
  "Team bag or seal used",
  "Labelled & documented cert / notes",
  "Packed securely (cardboard sandwich)",
  "Tracked postage selected",
  "Insurance considered for high value"
];
function loadChecklist(){ try{ const raw=localStorage.getItem(CHECK_KEY); return raw ? JSON.parse(raw) : {}; }catch(e){ return {}; } }
function renderChecklist(){
  const wrap=document.getElementById("checklist");
  if(!wrap) return;
  const state=loadChecklist();
  wrap.innerHTML = CHECK_ITEMS.map((t,i)=>{
    const id = `chk_${i}`;
    const checked = !!state[id];
    return `
      <div class="check-item">
        <input type="checkbox" id="${id}" ${checked?'checked':''}>
        <label for="${id}">${t}</label>
      </div>
    `;
  }).join("");
  CHECK_ITEMS.forEach((_,i)=>{
    const id=`chk_${i}`;
    const el=document.getElementById(id);
    if(el) el.addEventListener("change", ()=>saveChecklist());
  });
}
function saveChecklist(){
  const state={};
  CHECK_ITEMS.forEach((_,i)=>{
    const id=`chk_${i}`;
    const el=document.getElementById(id);
    if(el) state[id]=!!el.checked;
  });
  try{ localStorage.setItem(CHECK_KEY, JSON.stringify(state)); }catch(e){}
}
function resetChecklist(){ try{ localStorage.removeItem(CHECK_KEY); }catch(e){} renderChecklist(); }
function printChecklist(){ window.print(); }

/* Helpers */
function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* Enter key = Generate Comps */
(function bindSearchEnter(){
  const inp = document.getElementById("pokeSearch");
  if(!inp) return;
  inp.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){
      e.preventDefault();
      generateComps();
      const cb = document.getElementById("compBuilder");
      if(cb) cb.scrollIntoView({behavior:"smooth", block:"start"});
    }
  });
})();

/* BLANK PAGE FIX: reveal + failsafe */
(function(){
  const els = Array.from(document.querySelectorAll('.reveal'));
  const forceShowAll = () => els.forEach(el => el.classList.add('show'));

  if(els.length === 0) return;

  if(!('IntersectionObserver' in window)){
    forceShowAll();
    return;
  }

  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        e.target.classList.add('show');
        io.unobserve(e.target);
      }
    });
  }, {threshold:0.12});

  els.forEach(el => io.observe(el));

  setTimeout(()=>{
    const anyShown = els.some(el => el.classList.contains('show'));
    if(!anyShown) forceShowAll();
  }, 800);

  const wake = () => forceShowAll();
  window.addEventListener('scroll', wake, { once:true, passive:true });
  window.addEventListener('touchstart', wake, { once:true, passive:true });
})();

/* Onboarding controls */
const ONBOARD_KEY = "tcg_onboard_done_v1";
function showOnboardingIfNeeded(){
  try{
    const done = localStorage.getItem(ONBOARD_KEY);
    if(done) return;
  }catch(e){}
  const ob = document.getElementById("onboard");
  if(ob){
    ob.classList.add("show");
    ob.setAttribute("aria-hidden","false");
  }
}
function finishOnboarding(){
  try{ localStorage.setItem(ONBOARD_KEY, "1"); }catch(e){}
  const ob = document.getElementById("onboard");
  if(ob){
    ob.classList.remove("show");
    ob.setAttribute("aria-hidden","true");
  }
  const live = document.getElementById("live");
  if(live) live.scrollIntoView({behavior:"smooth", block:"start"});
}
function skipOnboarding(){ finishOnboarding(); }

/* ===== Flip Finder ===== */
const FF_DATA = {
  "Grails": [
    {
      name: "Charizard — Base Set Holo 4/102 (Unlimited) — 1999",
      search: "Charizard 4/102 Base Set holo raw",
      tags: ["Base Set", "Holo", "Unlimited"],
      notes: "How to tell: NO 1st Edition stamp. Usually has a shadow on the right side of the artwork box. Don’t confuse with Base Set 2 (has a '2' set symbol)."
    },
    {
      name: "Charizard — Base Set Holo 4/102 (Shadowless) — 1999",
      search: "Charizard 4/102 shadowless holo raw",
      tags: ["Base Set", "Holo", "Shadowless"],
      notes: "How to tell: NO shadow around the artwork box + thinner text styling. Don’t confuse with Unlimited (has shadow) or 1st Edition (stamp)."
    },
    {
      name: "Charizard — Base Set Holo 4/102 (1st Edition Shadowless) — 1999",
      search: "1st edition Charizard 4/102 shadowless holo raw",
      tags: ["Base Set", "Holo", "1st Ed", "Shadowless"],
      notes: "How to tell: 1st Edition stamp + NO shadow. High fake risk—prioritise clear back photo, print sharpness, and correct holo."
    }
  ],
  "Vintage Liquid": [
    { name:"Blastoise — Base Set Holo 2/102 — 1999", search:"Blastoise 2/102 base set holo raw",
      tags:["Base Set","Holo"], notes:"How to tell: No set symbol on the right. Classic Base layout." },
    { name:"Venusaur — Base Set Holo 15/102 — 1999", search:"Venusaur 15/102 base set holo raw",
      tags:["Base Set","Holo"], notes:"How to tell: No set symbol. Strong nostalgia demand." },
    { name:"Alakazam — Base Set Holo 1/102 — 1999", search:"Alakazam 1/102 base set holo raw",
      tags:["Base Set","Holo"], notes:"How to tell: No set symbol. Watch for holo scratching." },
    { name:"Mewtwo — Base Set Holo 10/102 — 1999", search:"Mewtwo 10/102 base set holo raw",
      tags:["Base Set","Holo"], notes:"How to tell: No set symbol. Often found in mixed lots." },
    { name:"Lugia — Neo Genesis Holo 9/111 — 2000", search:"Lugia 9/111 neo genesis holo raw",
      tags:["Neo Genesis","Holo"], notes:"How to tell: Neo Genesis set symbol. Don’t confuse with other Lugia sets." },
    { name:"Umbreon — Neo Discovery Holo 13/75 — 2001", search:"Umbreon 13/75 neo discovery holo raw",
      tags:["Neo Discovery","Holo"], notes:"How to tell: Neo Discovery symbol. Huge fan base; condition matters." },
    { name:"Espeon — Neo Discovery Holo 1/75 — 2001", search:"Espeon 1/75 neo discovery holo raw",
      tags:["Neo Discovery","Holo"], notes:"How to tell: Neo Discovery symbol. Often pairs with Umbreon buyers." }
  ],
  "Shining": [
    { name:"Shining Charizard — Neo Destiny 107/105 — 2002", search:"Shining Charizard 107/105 neo destiny raw",
      tags:["Neo Destiny","Shining"], notes:"How to tell: Shining outline effect + Neo Destiny symbol. Watch for proxies." },
    { name:"Shining Mewtwo — Neo Destiny 109/105 — 2002", search:"Shining Mewtwo 109/105 neo destiny raw",
      tags:["Neo Destiny","Shining"], notes:"How to tell: Shining outline + correct numbering. Strong liquidity." },
    { name:"Shining Gyarados — Neo Revelation 65/64 — 2001", search:"Shining Gyarados 65/64 neo revelation raw",
      tags:["Neo Revelation","Shining"], notes:"How to tell: Shining outline + 65/64 (over the set total). Often edge wear." }
  ],
  "Gold Stars": [
    { name:"Rayquaza ★ — EX Deoxys Gold Star 107/107 — 2005", search:"Rayquaza gold star 107/107 ex deoxys raw",
      tags:["EX Deoxys","Gold Star"], notes:"How to tell: Small gold star near name + 107/107. Avoid modern reprints/celebrations." },
    { name:"Latias ★ — EX Deoxys Gold Star 105/107 — 2005", search:"Latias gold star 105/107 ex deoxys raw",
      tags:["EX Deoxys","Gold Star"], notes:"How to tell: Gold star + 105/107. BIG trap: World Championships versions have a special back and are much cheaper." },
    { name:"Latios ★ — EX Deoxys Gold Star 106/107 — 2005", search:"Latios gold star 106/107 ex deoxys raw",
      tags:["EX Deoxys","Gold Star"], notes:"How to tell: Gold star + 106/107. Same trap risk—check the card back." }
  ],
  "Crystals & Special Holos": [
    { name:"Charizard — Skyridge Crystal Holo 146/144 — 2003", search:"Charizard 146/144 skyridge crystal holo raw",
      tags:["Skyridge","Crystal","Secret Rare"], notes:"How to tell: Crystal style + 146/144 (over set total). Very high value; verify authenticity." },
    { name:"Lugia — Aquapolis Crystal Holo 149/144 — 2003", search:"Lugia 149/144 aquapolis crystal holo raw",
      tags:["Aquapolis","Crystal","Secret Rare"], notes:"How to tell: Aquapolis symbol + 149/144. Rare; watch for heavy play." },
    { name:"Charizard — Legendary Collection Reverse Holo 3/110 — 2002", search:"Charizard 3/110 legendary collection reverse holo raw",
      tags:["Legendary Collection","Reverse Holo"], notes:"How to tell: Firework reverse holo pattern across the card. Don’t confuse with normal holo." },
    { name:"Deoxys — EX Deoxys Holo 2/107 — 2005", search:"Deoxys 2/107 ex deoxys holo raw",
      tags:["EX Deoxys","Holo"], notes:"How to tell: EX Deoxys set symbol + 2/107. Great lot-hunting target." }
  ]
};
function ffEl(id){ return document.getElementById(id); }
function ffInit(){
  const cat = ffEl("ffCat");
  const card = ffEl("ffCard");
  if(!cat || !card) return;

  cat.innerHTML = "";
  Object.keys(FF_DATA).forEach((k)=>{
    const opt = document.createElement("option");
    opt.value = k; opt.textContent = k;
    cat.appendChild(opt);
  });

  cat.addEventListener("change", ffLoadCards);
  card.addEventListener("change", ffRenderNotes);

  ffLoadCards();
}
function ffLoadCards(){
  const cat = ffEl("ffCat");
  const card = ffEl("ffCard");
  if(!cat || !card) return;

  const key = cat.value;
  card.innerHTML = "";
  FF_DATA[key].forEach((c,i)=>{
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = c.name;
    card.appendChild(opt);
  });

  ffRenderNotes();
}
function ffCurrent(){
  const cat = ffEl("ffCat");
  const card = ffEl("ffCard");
  const key = cat?.value;
  const idx = parseInt(card?.value || "0", 10);
  return FF_DATA[key][idx];
}
function ffQuery(){ return encodeURIComponent(ffCurrent().search); }
function ffRenderNotes(){
  const c = ffCurrent();
  const pills = ffEl("ffPills");
  const notes = ffEl("ffNotes");
  const pill = ffEl("ffTagPill");
  if(!c || !pills || !notes) return;

  pills.innerHTML = "";
  (c.tags || []).forEach(t=>{
    const d = document.createElement("div");
    d.className = "chip";
    d.textContent = t;
    pills.appendChild(d);
  });

  if(pill) pill.textContent = "Target";
  notes.textContent = `Search phrase: ${c.search}  |  ${c.notes}`;
}
function ffEbaySoldUK(){ window.open(`https://www.ebay.co.uk/sch/i.html?_nkw=${ffQuery()}&LH_Sold=1&LH_Complete=1`, "_blank"); }
function ffEbayLiveUK(){ window.open(`https://www.ebay.co.uk/sch/i.html?_nkw=${ffQuery()}`, "_blank"); }
function ffEbaySoldWW(){ window.open(`https://www.ebay.com/sch/i.html?_nkw=${ffQuery()}&LH_Sold=1&LH_Complete=1`, "_blank"); }
function ffVinted(){ window.open(`https://www.vinted.co.uk/catalog?search_text=${ffQuery()}`, "_blank"); }

/* Broker helpers */
const BR_KEY="tcg_broker_requests_v1";
function brLoad(){ try{ const raw=localStorage.getItem(BR_KEY); return raw?JSON.parse(raw):[]; }catch(e){ return []; } }
function brSave(list){ try{ localStorage.setItem(BR_KEY, JSON.stringify(list)); }catch(e){} }
function prefillFromSearch(){
  const q = (window.__lastCompQuery || document.getElementById("pokeSearch")?.value?.trim() || "");
  if(!q){ alert("Type a search term (Live Listings) and Generate Comps first."); return; }
  document.getElementById("br_card").value = q;
  document.getElementById("broker")?.scrollIntoView({behavior:"smooth", block:"start"});
}
function prefillBrokerFromQuery(){ prefillFromSearch(); }
function submitBrokerRequest(){
  const email = document.getElementById("br_email").value.trim();
  const card = document.getElementById("br_card").value.trim();
  const grade = document.getElementById("br_grade").value;
  const budget = document.getElementById("br_budget").value.trim();
  const urgency = document.getElementById("br_urgency").value;
  const notes = document.getElementById("br_notes").value.trim();

  if(!email || !card || !budget){
    alert("Please fill: email, card, and max budget.");
    return;
  }

  const list = brLoad();
  list.unshift({
    id:String(Date.now()),
    email, card, grade, budget, urgency, notes,
    created:new Date().toISOString()
  });
  brSave(list);

  alert("Saved. Next: pay the Broker Deposit to begin sourcing.");
  openCheckout("Broker Deposit (credited)", "£39.99 equivalent in USDT");
}
function emailBrokerRequest(){
  const email = document.getElementById("br_email").value.trim() || "";
  const card = document.getElementById("br_card").value.trim() || "";
  const grade = document.getElementById("br_grade").value || "";
  const budget = document.getElementById("br_budget").value.trim() || "";
  const urgency = document.getElementById("br_urgency").value || "";
  const notes = document.getElementById("br_notes").value.trim() || "";
  const subject = encodeURIComponent("TCG Expert Pro — Source a PSA Card Request");
  const body = encodeURIComponent(
`Hello TCG Expert Pro,

I would like you to source a PSA card.

Email: ${email}
Card: ${card}
Grade: ${grade}
Max budget (£): ${budget}
Urgency: ${urgency}
Notes: ${notes}

I understand the Broker Deposit (£39.99 equivalent in USDT) is non-refundable and credited toward the final total.

Thanks`
  );
  window.location.href = `mailto:tcgexpertpro@gmail.com?subject=${subject}&body=${body}`;
}

/* Seller Submit helpers */
const SS_KEY="tcg_seller_submit_v1";
function ssLoad(){ try{ const raw=localStorage.getItem(SS_KEY); return raw?JSON.parse(raw):[]; }catch(e){ return []; } }
function ssSave(list){ try{ localStorage.setItem(SS_KEY, JSON.stringify(list)); }catch(e){} }
function saveSellerSubmit(){
  const email = document.getElementById("ss_email").value.trim();
  const card = document.getElementById("ss_card").value.trim();
  const grade = document.getElementById("ss_grade").value.trim();
  const price = document.getElementById("ss_price").value.trim();
  const notes = document.getElementById("ss_notes").value.trim();
  if(!email || !card || !grade){
    alert("Please fill: email, card, and condition/grade.");
    return;
  }
  const list = ssLoad();
  list.unshift({ id:String(Date.now()), email, card, grade, price, notes, created:new Date().toISOString() });
  ssSave(list);
  alert("Saved. Next: pay Seller Submit fee to start (no refund).");
  openCheckout("Seller Submit (no refund)", "£6.99 equivalent in USDT");
}
function emailSellerSubmit(){
  const email = document.getElementById("ss_email").value.trim() || "";
  const card = document.getElementById("ss_card").value.trim() || "";
  const grade = document.getElementById("ss_grade").value.trim() || "";
  const price = document.getElementById("ss_price").value.trim() || "";
  const notes = document.getElementById("ss_notes").value.trim() || "";
  const subject = encodeURIComponent("TCG Expert Pro — Seller Submit (Find a Buyer) — £6.99");
  const body = encodeURIComponent(
`Hello TCG Expert Pro,

Seller Submit request (7 days):

Email: ${email}
Card: ${card}
Condition/Grade: ${grade}
Desired price (£): ${price}
Notes: ${notes}

I understand the £6.99 equivalent in USDT fee is non-refundable.

Thanks`
  );
  window.location.href = `mailto:tcgexpertpro@gmail.com?subject=${subject}&body=${body}`;
}

/* Checkout modal */
const WALLET = "0x15F4628c103D56eF81EDC45c7C3af33dA0B8442E";
function openCheckout(typeLabel, amountLabel){
  document.getElementById("payTypeLabel").textContent = typeLabel;
  document.getElementById("payAmountLabel").textContent = amountLabel;
  const m = document.getElementById("checkoutModal");
  m.style.display = "block";
  m.setAttribute("aria-hidden","false");
  document.body.style.overflow = "hidden";
}
function closeCheckout(){
  const m = document.getElementById("checkoutModal");
  m.style.display = "none";
  m.setAttribute("aria-hidden","true");
  document.body.style.overflow = "";
}
function copyWallet(){
  const txt = WALLET;
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(txt).then(()=>alert("Wallet copied."));
  } else {
    const t = document.createElement("textarea");
    t.value = txt; document.body.appendChild(t);
    t.select(); document.execCommand("copy");
    document.body.removeChild(t);
    alert("Wallet copied.");
  }
}
function emailTxid(){
  const txid = (document.getElementById("txidInput").value || "").trim();
  const type = document.getElementById("payTypeLabel").textContent || "";
  const amount = document.getElementById("payAmountLabel").textContent || "";
  const subject = encodeURIComponent(`TCG Expert Pro — Payment Proof — ${type}`);
  const body = encodeURIComponent(
`Hello TCG Expert Pro,

Payment proof:
Type: ${type}
Amount: ${amount}
Network: USDT (Tether) — Ethereum (ERC-20)
Wallet sent to: ${WALLET}
TXID: ${txid}

I am attaching a screenshot in this email.

Thanks`
  );
  window.location.href = `mailto:tcgexpertpro@gmail.com?subject=${subject}&body=${body}`;
}
function saveProof(){
  const txid = (document.getElementById("txidInput").value || "").trim();
  const type = document.getElementById("payTypeLabel").textContent || "";
  const amount = document.getElementById("payAmountLabel").textContent || "";
  try{
    const key = "tcg_payment_proofs_v1";
    const arr = JSON.parse(localStorage.getItem(key) || "[]");
    arr.unshift({ id:String(Date.now()), type, amount, txid, wallet:WALLET, network:"USDT ERC-20", created:new Date().toISOString() });
    localStorage.setItem(key, JSON.stringify(arr));
    alert("Saved locally.");
  }catch(e){
    alert("Could not save (storage blocked).");
  }
}
function openEtherscan(){
  window.open("https://etherscan.io/", "_blank");
}

/* Init */
window.addEventListener("load", ()=>{
  renderChecklist();
  renderWatchlist();
  renderCompBuilder();
  renderListingGrader();
  loadDealInputs();
  ffInit();

  ["dc_buy","dc_sale","dc_grade","dc_feePct"].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.addEventListener("input", saveDealInputs);
  });

  setTimeout(showOnboardingIfNeeded, 600);

  const w = document.getElementById("usdtWallet");
  if(w) w.textContent = WALLET;
});
</script>
</body>
</html> 